(window.webpackJsonp=window.webpackJsonp||[]).push([[259],{570:function(s,a,t){"use strict";t.r(a);var e=t(27),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"openssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openssh"}},[s._v("#")]),s._v(" OpenSSH")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.openssh.com/manual.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenSSH"),a("OutboundLink")],1),s._v(" 是使用 SSH 协议进行远程登录的主要连接工具。")]),s._v(" "),a("h2",{attrs:{id:"一、安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装"}},[s._v("#")]),s._v(" 一、安装")]),s._v(" "),a("h3",{attrs:{id:"centos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos"}},[s._v("#")]),s._v(" CentOS")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server\n")])])]),a("h2",{attrs:{id:"二、登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、登录"}},[s._v("#")]),s._v(" 二、登录")]),s._v(" "),a("h3",{attrs:{id:"口令登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#口令登录"}},[s._v("#")]),s._v(" 口令登录")]),s._v(" "),a("p",[s._v("以用户名 "),a("code",[s._v("user")]),s._v("，登录远程主机 "),a("code",[s._v("host")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" user@host\n")])])]),a("p",[s._v("口令登录的过程如下。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1、远程主机收到用户的登录请求，把自己的公钥发给用户。\n2、用户使用这个公钥，将登录密码加密后，发送给远程主机。\n3、远程主机用自己的私钥，解密登录密码，如果密码正确，就同意用户登录。\n")])])]),a("p",[s._v("口令登录有中间人攻击风险，可以手动校验公钥指纹。如 "),a("a",{attrs:{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/githubs-ssh-key-fingerprints",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"公钥登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公钥登录"}},[s._v("#")]),s._v(" 公钥登录")]),s._v(" "),a("p",[s._v("公钥登录的过程如下。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1、用户将自己的公钥储存在远程主机上。\n2、登录的时候，远程主机会向用户发送一段随机字符串，用户用自己的私钥加密后，再发回来。\n3、远程主机用事先储存的公钥进行解密，如果成功，就证明用户是可信的，直接允许登录，不再要求密码。\n")])])]),a("p",[s._v("如果没有现成的公钥，可以直接用 "),a("a",{attrs:{href:"https://man.openbsd.org/ssh-keygen",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("ssh-keygen")]),a("OutboundLink")],1),s._v(" 生成一个。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ssh-keygen "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" rsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"comment"')]),s._v("\n")])])]),a("p",[s._v("将公钥传送到远程主机 "),a("code",[s._v("host")]),s._v(" 上面，保存在登录后的用户主目录的 "),a("code",[s._v("~/.ssh/authorized_keys")]),s._v(" 文件中。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ssh-copy-id "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" user@host\n")])])]),a("p",[s._v("该命令等效于。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" user@host "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mkdir -p .ssh && cat >> .ssh/authorized_keys'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ~/.ssh/id_rsa.pub\n")])])]),a("p",[s._v("从 "),a("code",[s._v("known_hosts")]),s._v(" 文件中删除属于指定主机名的所有公钥。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ssh-keygen "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n")])])]),a("h2",{attrs:{id:"三、配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、配置"}},[s._v("#")]),s._v(" 三、配置")]),s._v(" "),a("h3",{attrs:{id:"客户端配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置"}},[s._v("#")]),s._v(" 客户端配置")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://man.openbsd.org/ssh.1",target:"_blank",rel:"noopener noreferrer"}},[s._v("ssh"),a("OutboundLink")],1),s._v(" 按以下顺序获取配置数据。")]),s._v(" "),a("ul",[a("li",[s._v("命令行选项。")]),s._v(" "),a("li",[s._v("用户配置文件 "),a("code",[s._v("~/.ssh/config")]),s._v("。")]),s._v(" "),a("li",[s._v("系统配置文件 "),a("code",[s._v("/etc/ssh/ssh_config")]),s._v("。")])]),s._v(" "),a("p",[s._v("配置选项及其含义如下：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("StrictHostKeyChecking")]),s._v("：严格的主机密钥检查，此选项强制用户手动添加所有新主机到 "),a("code",[s._v("known_hosts")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("UserKnownHostsFile")]),s._v("：指定用于用户主机密钥数据库的文件。")])]),s._v(" "),a("p",[s._v("可以通过 "),a("code",[s._v("-o")]),s._v(" 选项动态指定配置。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("StrictHostKeyChecking")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no user@host\n")])])]),a("h3",{attrs:{id:"服务端配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[s._v("#")]),s._v(" 服务端配置")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://man.openbsd.org/sshd.8",target:"_blank",rel:"noopener noreferrer"}},[s._v("sshd"),a("OutboundLink")],1),s._v(" 从 "),a("code",[s._v("/etc/ssh/sshd_config")]),s._v(" 读取配置数据。")]),s._v(" "),a("p",[s._v("配置选项及其含义如下：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("PasswordAuthentication")]),s._v("：指定是否允许密码身份验证，默认值为 "),a("code",[s._v("yes")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("PermitRootLogin")]),s._v("：指定 "),a("code",[s._v("root")]),s._v(" 是否可以使用 "),a("code",[s._v("ssh")]),s._v(" 登录。")]),s._v(" "),a("li",[a("strong",[s._v("PubkeyAuthentication")]),s._v("：指定是否允许公钥身份验证，默认值为 "),a("code",[s._v("yes")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("AuthorizedKeysFile")]),s._v("：指定包含用于用户身份验证的公钥数据文件，默认值为 "),a("code",[s._v(".ssh/authorized_keys")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("GatewayPorts")]),s._v("：指定是否允许远程主机连接到通过 SSH 隧道打开的端口，默认值为 "),a("code",[s._v("no")]),s._v("。")])]),s._v(" "),a("p",[s._v("Xshell 登录时，如果提示找不到匹配的 "),a("em",[s._v("host key")]),s._v(" 算法，是因为 OpenSSH 弃用 "),a("em",[s._v("rsa")]),s._v(" 导致的，可以配置 "),a("code",[s._v("sshd_config")]),s._v(" 启用 "),a("em",[s._v("rsa")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("HostKeyAlgorithms +ssh-rsa\n")])])]),a("h2",{attrs:{id:"四、代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、代理"}},[s._v("#")]),s._v(" 四、代理")]),s._v(" "),a("h3",{attrs:{id:"正向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[s._v("#")]),s._v(" 正向代理")]),s._v(" "),a("p",[s._v("正向代理是客户端和目标服务器之间的中介，客户端向代理服务器发送请求，然后由代理服务器转发请求到目标服务器，并将目标服务器的响应返回给客户端。")]),s._v(" "),a("p",[s._v("例如，在代理服务器上启动一个 "),a("code",[s._v("3800")]),s._v(" 端口，映射到 "),a("code",[s._v("119.29.29.29:80")]),s._v(" 上，通过 "),a("code",[s._v("host")]),s._v(" 服务器中转。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3800:119.29.29.29:80 user@host\n")])])]),a("h3",{attrs:{id:"反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),a("p",[s._v("反向代理是在目标服务器和客户端之间的中介，客户端向反向代理服务器发送请求，然后由代理服务器选择一个目标服务器来处理请求，最后将目标服务器的响应返回给客户端。")]),s._v(" "),a("p",[s._v("在本地服务器上运行以下代码，将自己可以访问的 "),a("code",[s._v("119.29.29.29:80")]),s._v(" 暴露给 "),a("code",[s._v("host")]),s._v(" 的指定端口。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3800:119.29.29.29:80 user@host\n")])])]),a("h3",{attrs:{id:"socks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#socks"}},[s._v("#")]),s._v(" SOCKS")]),s._v(" "),a("p",[s._v("在本地端口启动一个 SOCKS 服务，数据通过 "),a("code",[s._v("host")]),s._v(" 转发给目标服务器。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:1080 user@host\n")])])]),a("h3",{attrs:{id:"优化参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化参数"}},[s._v("#")]),s._v(" 优化参数")]),s._v(" "),a("ul",[a("li",[s._v("-"),a("strong",[s._v("C")]),s._v("：压缩数据。")]),s._v(" "),a("li",[s._v("-"),a("strong",[s._v("q")]),s._v("：安静模式。")]),s._v(" "),a("li",[s._v("-"),a("strong",[s._v("T")]),s._v("：禁止远程分配终端。")]),s._v(" "),a("li",[s._v("-"),a("strong",[s._v("n")]),s._v("：关闭标准输入。")]),s._v(" "),a("li",[s._v("-"),a("strong",[s._v("N")]),s._v("：不执行远程命令。")]),s._v(" "),a("li",[s._v("-"),a("strong",[s._v("f")]),s._v("：后台运行。")])]),s._v(" "),a("h2",{attrs:{id:"五、安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、安全"}},[s._v("#")]),s._v(" 五、安全")]),s._v(" "),a("h3",{attrs:{id:"cve-2024-6387"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cve-2024-6387"}},[s._v("#")]),s._v(" CVE-2024-6387")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://v2ex.com/t/1054091",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenSSH 爆高危漏洞 CVE-2024-6387 - V2EX"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cve.org/CVERecord?id=CVE-2024-6387",target:"_blank",rel:"noopener noreferrer"}},[s._v("CVE-2024-6387"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://security-tracker.debian.org/tracker/CVE-2024-6387",target:"_blank",rel:"noopener noreferrer"}},[s._v("Debian"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://avd.aliyun.com/detail?id=AVD-2024-6387",target:"_blank",rel:"noopener noreferrer"}},[s._v("Aliyun"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);