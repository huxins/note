(window.webpackJsonp=window.webpackJsonp||[]).push([[262],{577:function(t,s,e){"use strict";e.r(s);var a=e(27),r=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"systemd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#systemd"}},[t._v("#")]),t._v(" Systemd")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://systemd.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Systemd"),s("OutboundLink")],1),t._v(" 是一种系统和服务管理器。它是用于引导系统、启动和管理服务、处理系统状态的核心组件之一。")]),t._v(" "),s("p",[t._v("Systemd 包含许多工具和功能，例如服务管理、日志记录、设备管理、用户会话管理等。它取代了传统的 SysV init 和 Upstart 系统，成为主流 Linux 发行版的默认初始化系统。")]),t._v(" "),s("h2",{attrs:{id:"一、命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、命令"}},[t._v("#")]),t._v(" 一、命令")]),t._v(" "),s("p",[t._v("Systemd 提供了一系列命令来管理服务、日志、设备等。")]),t._v(" "),s("h3",{attrs:{id:"系统管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统管理"}},[t._v("#")]),t._v(" 系统管理")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemctl.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("systemctl")]),s("OutboundLink")],1),t._v(" 是 Systemd 的主命令，用于管理系统和服务。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("systemctl reboot")]),t._v("：重启系统。")]),t._v(" "),s("li",[s("code",[t._v("systemctl poweroff")]),t._v("：关闭系统，切断电源。")]),t._v(" "),s("li",[s("code",[t._v("systemctl halt")]),t._v("：CPU 停止工作。")]),t._v(" "),s("li",[s("code",[t._v("systemctl suspend")]),t._v("：暂停系统。")]),t._v(" "),s("li",[s("code",[t._v("systemctl hibernate")]),t._v("：让系统进入冬眠状态。")]),t._v(" "),s("li",[s("code",[t._v("systemctl hybrid-sleep")]),t._v("：让系统进入交互式休眠状态。")]),t._v(" "),s("li",[s("code",[t._v("systemctl rescue")]),t._v("：启动进入救援状态。")]),t._v(" "),s("li",[s("code",[t._v("systemctl isolate")]),t._v("：切换到特定的运行目标（例如，单用户模式、多用户模式）。")])]),t._v(" "),s("h3",{attrs:{id:"服务管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务管理"}},[t._v("#")]),t._v(" 服务管理")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("systemctl daemon-reload")]),t._v("：重新加载配置文件。")]),t._v(" "),s("li",[s("code",[t._v("systemctl list-units")]),t._v("：列出所有已加载的单元（服务、设备等）。")]),t._v(" "),s("li",[s("code",[t._v("systemctl list-dependencies")]),t._v("：查看服务依赖。")]),t._v(" "),s("li",[s("code",[t._v("systemctl start")]),t._v("：启动服务。")]),t._v(" "),s("li",[s("code",[t._v("systemctl stop")]),t._v("：停止服务。")]),t._v(" "),s("li",[s("code",[t._v("systemctl restart")]),t._v("：重启服务。")]),t._v(" "),s("li",[s("code",[t._v("systemctl reload")]),t._v("：重新加载服务配置（不重启服务）。")]),t._v(" "),s("li",[s("code",[t._v("systemctl enable")]),t._v("：设置服务开机自启。")]),t._v(" "),s("li",[s("code",[t._v("systemctl disable")]),t._v("：禁用服务开机自启。")]),t._v(" "),s("li",[s("code",[t._v("systemctl status")]),t._v("：查看服务状态。")])]),t._v(" "),s("p",[t._v("例如，查看已加载的服务。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl list-units "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("service "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" postgresql\n")])])]),s("p",[t._v("例如，查看服务依赖。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl list-dependencies graphical.target\n")])])]),s("p",[t._v("例如，设置服务开机自启。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Created symlink from /etc/systemd/system/multi-user.target.wants/sshd.service to /usr/lib/systemd/system/sshd.service.")]),t._v("\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" sshd\n")])])]),s("h3",{attrs:{id:"运行目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行目标"}},[t._v("#")]),t._v(" 运行目标")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("systemctl get-default")]),t._v("：查看当前系统的默认运行目标。")]),t._v(" "),s("li",[s("code",[t._v("systemctl set-default")]),t._v("：设置默认运行目标。")]),t._v(" "),s("li",[t._v("常见运行目标：\n"),s("ul",[s("li",[s("code",[t._v("graphical.target")]),t._v("：图形界面模式。")]),t._v(" "),s("li",[s("code",[t._v("multi-user.target")]),t._v("：多用户模式（无图形界面）。")]),t._v(" "),s("li",[s("code",[t._v("rescue.target")]),t._v("：救援模式。")]),t._v(" "),s("li",[s("code",[t._v("emergency.target")]),t._v("：紧急模式。")])])])]),t._v(" "),s("h3",{attrs:{id:"日志管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志管理"}},[t._v("#")]),t._v(" 日志管理")]),t._v(" "),s("p",[s("em",[t._v("Systemd")]),t._v(" 统一管理所有 "),s("em",[t._v("Unit")]),t._v(" 的启动日志，可以只用 "),s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/journalctl.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("journalctl")]),s("OutboundLink")],1),t._v(" 一个命令，查看所有日志。日志的配置文件是 "),s("code",[t._v("/etc/systemd/journald.conf")]),t._v("。")]),t._v(" "),s("ul",[s("li",[t._v("-"),s("strong",[t._v("x")]),t._v("：显示日志的详细信息，包括每行的字段。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("e")]),t._v("：从日志的最后一行开始显示。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("u")]),t._v(" "),s("em",[t._v("UNIT")]),t._v("：显示指定 "),s("em",[t._v("UNIT")]),t._v(" 匹配的日志。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("f")]),t._v("：实时查看日志。")]),t._v(" "),s("li",[t._v("--"),s("strong",[t._v("vacuum-size")]),t._v("="),s("em",[t._v("100M")]),t._v("：删除最旧的日志文件，直到它们使用的磁盘空间低于指定的大小。接受 "),s("code",[t._v("K")]),t._v("、"),s("code",[t._v("M")]),t._v("、"),s("code",[t._v("G")]),t._v(" 和 "),s("code",[t._v("T")]),t._v(" 后缀。")]),t._v(" "),s("li",[t._v("--"),s("strong",[t._v("vacuum-time")]),t._v("="),s("em",[t._v("7d")]),t._v("：删除早于指定时间跨度的日志文件。接受 "),s("code",[t._v("s")]),t._v("、"),s("code",[t._v("m")]),t._v("、"),s("code",[t._v("h")]),t._v("、"),s("code",[t._v("days")]),t._v("、"),s("code",[t._v("weeks")]),t._v("、"),s("code",[t._v("months")]),t._v(" 和 "),s("code",[t._v("years")]),t._v(" 后缀。")]),t._v(" "),s("li",[t._v("--"),s("strong",[t._v("rotate")]),t._v("：归档日志文件并重命名，然后创建新的日志文件。"),s("em",[t._v("Added in version 227.")])])]),t._v(" "),s("p",[t._v("查看日志。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("journalctl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-xeu")]),t._v(" mysqld.service\n")])])]),s("p",[t._v("清除日志。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("journalctl --vacuum-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("100M --vacuum-time"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("7d\n")])])]),s("p",[t._v("较低版本清除日志。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl stop systemd-journald\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /run/log/journal/7fd8464130ec492c90c5cb07a51beedb/system.journal\nsystemctl start systemd-journald\n")])])]),s("h3",{attrs:{id:"启动耗时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动耗时"}},[t._v("#")]),t._v(" 启动耗时")]),t._v(" "),s("p",[s("code",[t._v("systemd-analyze")]),t._v(" 命令用于查看启动耗时。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("systemd-analyze")]),t._v("：查看启动耗时。")]),t._v(" "),s("li",[s("code",[t._v("systemd-analyze blame")]),t._v("：查看每个服务的启动耗时。")]),t._v(" "),s("li",[s("code",[t._v("systemd-analyze critical-chain")]),t._v("：显示瀑布状的启动过程流。")])]),t._v(" "),s("p",[t._v("例如，显示瀑布状的启动过程流。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemd-analyze critical-chain atd.service\n")])])]),s("h3",{attrs:{id:"主机信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主机信息"}},[t._v("#")]),t._v(" 主机信息")]),t._v(" "),s("p",[s("code",[t._v("hostnamectl")]),t._v(" 命令用于查看当前主机的信息。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("hostnamectl")]),t._v("：显示当前主机的信息。")]),t._v(" "),s("li",[s("code",[t._v("hostnamectl set-hostname")]),t._v("：设置主机名。")])]),t._v(" "),s("p",[t._v("例如，设置主机名。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("hostnamectl set-hostname rhel7\n")])])]),s("h3",{attrs:{id:"区域语言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#区域语言"}},[t._v("#")]),t._v(" 区域语言")]),t._v(" "),s("p",[s("code",[t._v("localectl")]),t._v(" 命令用于查看本地化设置。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("localectl")]),t._v("：查看本地化设置。")]),t._v(" "),s("li",[s("code",[t._v("localectl set-locale")]),t._v("：设置本地化区域。")]),t._v(" "),s("li",[s("code",[t._v("localectl set-keymap")]),t._v("：设置本地化键盘布局。")])]),t._v(" "),s("p",[t._v("设置本地化区域。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("localectl set-locale "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("LANG")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("en_GB.utf8\nlocalectl set-locale "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("LANG")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("en_US.utf8\nlocalectl set-locale "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("LANG")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("zh_CN.UTF8\n")])])]),s("p",[t._v("设置本地化键盘布局。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("localectl set-keymap en_GB\n")])])]),s("h3",{attrs:{id:"日期时间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日期时间"}},[t._v("#")]),t._v(" 日期时间")]),t._v(" "),s("p",[s("code",[t._v("timedatectl")]),t._v(" 命令用于控制系统时间和日期。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("timedatectl")]),t._v("：查看当前时区设置。")]),t._v(" "),s("li",[s("code",[t._v("timedatectl list-timezones")]),t._v("：显示所有可用的时区。")]),t._v(" "),s("li",[s("code",[t._v("timedatectl set-timezone")]),t._v("：设置当前时区。")])]),t._v(" "),s("p",[t._v("设置当前时区。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("timedatectl set-timezone America/New_York\ntimedatectl set-timezone Asia/Shanghai\n")])])]),s("h3",{attrs:{id:"登录用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登录用户"}},[t._v("#")]),t._v(" 登录用户")]),t._v(" "),s("p",[s("code",[t._v("loginctl")]),t._v(" 命令用于查看当前登录的用户。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("loginctl list-sessions")]),t._v("：列出当前 "),s("em",[t._v("session")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("loginctl list-users")]),t._v("：列出当前登录用户。")]),t._v(" "),s("li",[s("code",[t._v("loginctl show-user")]),t._v("：显示指定用户的信息。")])]),t._v(" "),s("p",[t._v("显示指定用户的信息。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("loginctl show-user root\n")])])]),s("h2",{attrs:{id:"二、unit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、unit"}},[t._v("#")]),t._v(" 二、Unit")]),t._v(" "),s("p",[t._v("Systemd 可以管理所有系统资源，不同的资源统称为 "),s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Unit"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Service")]),t._v("：系统服务。")]),t._v(" "),s("li",[s("strong",[t._v("Target")]),t._v("：多个 Unit 构成的一个组。")]),t._v(" "),s("li",[s("strong",[t._v("Device")]),t._v("：硬件设备。")]),t._v(" "),s("li",[s("strong",[t._v("Mount")]),t._v("：文件系统的挂载点。")]),t._v(" "),s("li",[s("strong",[t._v("Automount")]),t._v("：自动挂载点。")]),t._v(" "),s("li",[s("strong",[t._v("Path")]),t._v("：文件或路径。")]),t._v(" "),s("li",[s("strong",[t._v("Scope")]),t._v("：不是由 Systemd 启动的外部进程。")]),t._v(" "),s("li",[s("strong",[t._v("Slice")]),t._v("：进程组。")]),t._v(" "),s("li",[s("strong",[t._v("Snapshot")]),t._v("：Systemd 快照，可以切回某个快照。")]),t._v(" "),s("li",[s("strong",[t._v("Socket")]),t._v("：进程间通信的 "),s("em",[t._v("socket")]),t._v("。")]),t._v(" "),s("li",[s("strong",[t._v("Swap")]),t._v("："),s("em",[t._v("swap")]),t._v(" 文件。")]),t._v(" "),s("li",[s("strong",[t._v("Timer")]),t._v("：定时器。")])]),t._v(" "),s("h3",{attrs:{id:"状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#状态"}},[t._v("#")]),t._v(" 状态")]),t._v(" "),s("p",[s("code",[t._v("systemctl status")]),t._v(" 命令用于查看系统状态和单个 Unit 的状态。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl status                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示系统状态")]),t._v("\nsystemctl status mysqld.service     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示单个 Unit 的状态")]),t._v("\n")])])]),s("p",[t._v("除了 "),s("code",[t._v("status")]),t._v(" 命令，"),s("code",[t._v("systemctl")]),t._v(" 还提供了三个查询状态的简单方法，主要供脚本内部的判断语句使用。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl is-active mysqld.service          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示某个 Unit 是否正在运行")]),t._v("\nsystemctl is-failed mysqld.service          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示某个 Unit 是否处于启动失败状态")]),t._v("\nsystemctl is-enabled mysqld.service         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示某个 Unit 服务是否建立了启动链接")]),t._v("\n")])])]),s("h3",{attrs:{id:"管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管理"}},[t._v("#")]),t._v(" 管理")]),t._v(" "),s("p",[t._v("立即启动一个服务。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl start mysqld.service\n")])])]),s("p",[t._v("立即停止一个服务。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl stop mysqld.service\n")])])]),s("p",[t._v("重启一个服务。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl restart mysqld.service\n")])])]),s("p",[t._v("杀死一个服务的所有子进程。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" mysqld.service\n")])])]),s("p",[t._v("重新加载一个服务的配置文件。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl reload mysqld.service\n")])])]),s("p",[t._v("重载所有修改过的配置文件。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl daemon-reload\n")])])]),s("p",[t._v("显示某个 Unit 的所有底层参数。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl show mysqld.service\n")])])]),s("p",[t._v("显示某个 Unit 的指定属性的值。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl show "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" CPUShares mysqld.service\n")])])]),s("p",[t._v("设置某个 Unit 的指定属性。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl set-property mysqld.service "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CPUShares")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("\n")])])]),s("h3",{attrs:{id:"依赖关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖关系"}},[t._v("#")]),t._v(" 依赖关系")]),t._v(" "),s("p",[t._v("Unit 之间存在依赖关系：A 依赖于 B，就意味着 "),s("em",[t._v("Systemd")]),t._v(" 在启动 A 的时候，同时会去启动 B。")]),t._v(" "),s("p",[s("code",[t._v("systemctl list-dependencies")]),t._v(" 命令列出一个 Unit 的所有依赖。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl list-dependencies mysqld.service\n")])])]),s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),s("p",[t._v("每一个 Unit 都有一个配置文件，告诉 "),s("em",[t._v("Systemd")]),t._v(" 怎么启动这个 Unit。")]),t._v(" "),s("p",[t._v("System Unit 从"),s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#System%20Unit%20Search%20Path",target:"_blank",rel:"noopener noreferrer"}},[t._v("多个目录"),s("OutboundLink")],1),t._v("读取配置文件。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/etc/systemd/system/*\n/usr/lib/systemd/system/*\n")])])]),s("p",[s("code",[t._v("systemctl list-unit-files")]),t._v(" 命令用于列出所有配置文件。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl list-unit-files                  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出所有配置文件")]),t._v("\nsystemctl list-unit-files "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("service   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出指定类型的配置文件")]),t._v("\n")])])]),s("p",[s("code",[t._v("systemctl cat")]),t._v(" 命令可以查看配置文件的内容。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" mysqld.service\n")])])]),s("p",[t._v("以 "),s("code",[t._v("sshd.service")]),t._v(" 为例。")]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /usr/lib/systemd/system/sshd.service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Unit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("OpenSSH server daemon")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Documentation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("man:sshd(8) man:sshd_config(5)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("After")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("network.target sshd-keygen.service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Wants")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("sshd-keygen.service")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("notify")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("EnvironmentFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/etc/sysconfig/sshd")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("ExecStart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/usr/sbin/sshd -D $OPTIONS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("ExecReload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/bin/kill -HUP $MAINPID")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("KillMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("process")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on-failure")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("RestartSec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("42s")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("WantedBy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("multi-user.target")]),t._v("\n")])])]),s("h4",{attrs:{id:"unit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#unit"}},[t._v("#")]),t._v(" Unit")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#%5BUnit%5D%20Section%20Options",target:"_blank",rel:"noopener noreferrer"}},[s("em",[t._v("Unit")]),s("OutboundLink")],1),t._v(" 区块通常是配置文件的第一个区块，用来定义 "),s("em",[t._v("Unit")]),t._v(" 的元数据，以及配置与其他 "),s("em",[t._v("Unit")]),t._v(" 的关系。")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#Requires=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Requires")]),s("OutboundLink")],1),t._v("：强依赖关系")]),t._v(" "),s("p",[t._v("当前 "),s("em",[t._v("Unit")]),t._v(" 依赖的其他 "),s("em",[t._v("Unit")]),t._v("，如果它们没有运行，当前 "),s("em",[t._v("Unit")]),t._v(" 会启动失败。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Wants")]),t._v("：弱依赖关系")]),t._v(" "),s("p",[t._v("与当前 "),s("em",[t._v("Unit")]),t._v(" 配合的其他 "),s("em",[t._v("Unit")]),t._v("，如果它们没有运行，当前 "),s("em",[t._v("Unit")]),t._v(" 不会启动失败。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("After")])]),t._v(" "),s("p",[t._v("如果该字段指定的 "),s("em",[t._v("Unit")]),t._v(" 也要启动，那么必须在当前 "),s("em",[t._v("Unit")]),t._v(" 之前启动。")])])]),t._v(" "),s("h4",{attrs:{id:"install"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install"}},[t._v("#")]),t._v(" Install")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#%5BInstall%5D%20Section%20Options",target:"_blank",rel:"noopener noreferrer"}},[s("em",[t._v("Install")]),s("OutboundLink")],1),t._v(" 通常是配置文件的最后一个区块，用来定义如何启动，以及是否开机启动。")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#WantedBy=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("WantedBy")]),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("它的值是一个或多个 "),s("em",[t._v("Target")]),t._v("，当前 "),s("em",[t._v("Unit")]),t._v(" "),s("code",[t._v("enable")]),t._v(" 时符号链接会放入 "),s("em",[t._v("/etc/systemd/system")]),t._v(" 目录下面以 "),s("em",[t._v("Target")]),t._v(" 名 + "),s("em",[t._v(".wants")]),t._v(" 后缀构成的子目录中。")])])]),t._v(" "),s("h4",{attrs:{id:"service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Options",target:"_blank",rel:"noopener noreferrer"}},[s("em",[t._v("Service")]),s("OutboundLink")],1),t._v(" 区块用来描述 "),s("em",[t._v("Service")]),t._v(" 的配置，只有 "),s("em",[t._v("Service")]),t._v(" 类型的 "),s("em",[t._v("Unit")]),t._v(" 才有这个区块。")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Type=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Type")]),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("simple")]),t._v("：默认值，执行 "),s("em",[t._v("ExecStart")]),t._v(" 指定的命令，启动主进程。")])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#ExecStart=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("ExecStart")]),s("OutboundLink")],1),t._v("：启动当前服务的命令。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#RestartSec=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("RestartSec")]),s("OutboundLink")],1),t._v("：重启当前服务间隔的秒数。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Restart=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Restart")]),s("OutboundLink")],1),t._v("：定义何种情况 "),s("em",[t._v("Systemd")]),t._v(" 会自动重启当前服务。值包括 "),s("code",[t._v("always")]),t._v("、"),s("code",[t._v("no")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#Environment=",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Environment")]),s("OutboundLink")],1),t._v("：指定环境变量。")])])]),t._v(" "),s("h3",{attrs:{id:"实例化单元"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实例化单元"}},[t._v("#")]),t._v(" 实例化单元")]),t._v(" "),s("p",[t._v("可以使用单个模板配置来管理服务的"),s("a",{attrs:{href:"https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/8/html/using_systemd_unit_files_to_customize_and_optimize_your_system/con_working-with-instantiated-units_assembly_working-with-systemd-unit-files",target:"_blank",rel:"noopener noreferrer"}},[t._v("多个实例"),s("OutboundLink")],1),t._v("。可以为单元定义一个通用模板，并在运行时使用特定参数生成该单元的多个实例。")]),t._v(" "),s("h2",{attrs:{id:"三、target"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、target"}},[t._v("#")]),t._v(" 三、Target")]),t._v(" "),s("p",[t._v("启动计算机的时候，需要启动大量的 "),s("em",[t._v("Unit")]),t._v("。如果每一次启动，都要写明本次启动需要哪些 "),s("em",[t._v("Unit")]),t._v("，显然非常不方便。"),s("em",[t._v("Systemd")]),t._v(" 的解决方案就是 "),s("em",[t._v("Target")]),t._v("。")]),t._v(" "),s("p",[t._v("简单说，"),s("em",[t._v("Target")]),t._v(" 就是一个 "),s("em",[t._v("Unit")]),t._v(" 组，包含许多相关的 "),s("em",[t._v("Unit")]),t._v("。启动某个 "),s("em",[t._v("Target")]),t._v(" 的时候，"),s("em",[t._v("Systemd")]),t._v(" 就会启动里面所有的 "),s("em",[t._v("Unit")]),t._v("。从这个意义上说，"),s("em",[t._v("Target")]),t._v(" 这个概念类似于状态点，启动某个 "),s("em",[t._v("Target")]),t._v(" 就好比启动到某种状态。")]),t._v(" "),s("p",[t._v("查看当前系统的所有 "),s("em",[t._v("Target")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl list-unit-files "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("target\n")])])]),s("p",[t._v("查看一个 "),s("em",[t._v("Target")]),t._v(" 包含的所有 "),s("em",[t._v("Unit")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl list-dependencies multi-user.target\n")])])]),s("p",[t._v("查看启动时的默认 "),s("em",[t._v("Target")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl get-default\n")])])]),s("p",[t._v("设置启动时的"),s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/bootup.html#System%20Manager%20Bootup",target:"_blank",rel:"noopener noreferrer"}},[t._v("默认"),s("OutboundLink")],1),t._v(" "),s("em",[t._v("Target")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl set-default multi-user.target\n")])])]),s("h2",{attrs:{id:"四、service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、service"}},[t._v("#")]),t._v(" 四、Service")]),t._v(" "),s("h3",{attrs:{id:"systemd-resolved"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#systemd-resolved"}},[t._v("#")]),t._v(" systemd-resolved")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd-resolved.service.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("systemd-resolved")]),s("OutboundLink")],1),t._v(" 主要用于管理 DNS 解析和域名解析"),s("a",{attrs:{href:"https://www.linuxtricks.fr/wiki/systemd-la-resolution-de-nom-avec-systemd-resolved",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("resolvectl status\n")])])]),s("ul",[s("li",[s("strong",[t._v("DNS 解析管理")]),t._v("：\n"),s("ul",[s("li",[t._v("统一管理不同网络接口（如以太网、Wi-Fi、VPN）的 DNS 配置，支持按接口优先级动态切换 DNS 服务器。")]),t._v(" "),s("li",[t._v("通过 "),s("code",[t._v("/etc/resolv.conf")]),t._v(" 的符号链接（默认指向 "),s("code",[t._v("/run/systemd/resolve/resolv.conf")]),t._v(" 或 "),s("code",[t._v("/run/systemd/resolve/stub-resolv.conf")]),t._v("）为应用程序提供 DNS 配置。")])])]),t._v(" "),s("li",[s("strong",[t._v("DNS 缓存")]),t._v("：提供本地 DNS 缓存，加速重复查询的响应速度，减少外部 DNS 服务器的请求压力。")]),t._v(" "),s("li",[s("strong",[t._v("高级功能支持")]),t._v("：\n"),s("ul",[s("li",[s("strong",[t._v("DNSSEC 验证")]),t._v("：自动验证 DNS 记录的完整性，防止域名劫持。")]),t._v(" "),s("li",[s("strong",[t._v("DNS over TLS (DoT)")]),t._v("：支持加密的 DNS 查询，提升隐私和安全性。")]),t._v(" "),s("li",[t._v("LLMNR（本地链路多播名称解析）和 mDNS（多播 DNS）：用于局域网内的主机名解析（类似 Avahi）。")])])])]),t._v(" "),s("p",[t._v("如需使用其他 DNS 工具（如 "),s("code",[t._v("dnsmasq")]),t._v("、"),s("code",[t._v("unbound")]),t._v("），或需要手动管理 "),s("code",[t._v("/etc/resolv.conf")]),t._v("，可以关闭 "),s("code",[t._v("systemd-resolved")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systemctl stop systemd-resolved.service\nsystemctl disable systemd-resolved.service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" /etc/resolv.conf\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nameserver 100.100.2.136"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/resolv.conf\n")])])]),s("p",[s("code",[t._v("systemd-resolved")]),t._v(" 不会监听标准的 "),s("code",[t._v("127.0.0.1:53")]),t._v("，而是使用 "),s("code",[t._v("127.0.0.53:53")]),t._v(" 和 "),s("code",[t._v("127.0.0.54:53")]),t._v(" 作为其默认监听地址。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nslookup")]),t._v(" example.com "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.53\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nslookup")]),t._v(" example.com "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.54\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);