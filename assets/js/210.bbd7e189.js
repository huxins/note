(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{522:function(t,s,a){"use strict";a.r(s);var e=a(27),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"postgresql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgresql"}},[t._v("#")]),t._v(" PostgreSQL")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/current/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL"),s("OutboundLink")],1),t._v(" 是一个强大的开源对象关系数据库系统，它使用并扩展了 SQL 语言，并结合了许多功能，可以安全地存储和扩展最复杂的数据工作负载。")]),t._v(" "),s("h2",{attrs:{id:"一、安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、安装"}},[t._v("#")]),t._v(" 一、安装")]),t._v(" "),s("h3",{attrs:{id:"red-hat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#red-hat"}},[t._v("#")]),t._v(" Red Hat")]),t._v(" "),s("p",[t._v("要使用 PostgreSQL "),s("a",{attrs:{href:"https://www.postgresql.org/download/linux/redhat/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Yum Repository"),s("OutboundLink")],1),t._v("，请按以下步骤操作。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" postgresql12-server\n")])])]),s("p",[t._v("切换腾讯镜像源进行网络加速。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s|download.postgresql.org/pub|mirrors.cloud.tencent.com/postgresql|g'")]),t._v(" /etc/yum.repos.d/pgdg-redhat-all.repo\n")])])]),s("p",[t._v("初始化数据库并启动服务。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("/usr/pgsql-12/bin/postgresql-12-setup initdb\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" postgresql-12\nsystemctl start postgresql-12\n")])])]),s("h3",{attrs:{id:"debian"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#debian"}},[t._v("#")]),t._v(" Debian")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/download/linux/debian/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Debian"),s("OutboundLink")],1),t._v(" 默认包含 PostgreSQL。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" postgresql\n")])])]),s("h3",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),s("p",[t._v("Docker 可以不受宿主机的限制，安装各种版本的 PostgreSQL。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(":5432 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--restart")]),t._v(" always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("POSTGRES_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("password "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia/Shanghai "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /var/lib/postgres/data:/var/lib/postgresql/data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  postgres:10.7-alpine\n")])])]),s("p",[s("code",[t._v("PGDATA")]),t._v(" 在 "),s("a",{attrs:{href:"https://hub.docker.com/_/postgres",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker"),s("OutboundLink")],1),t._v(" 中的默认路径为 "),s("code",[t._v("/var/lib/postgresql/data")]),t._v("，需要持久化数据时，请将此目录挂载到宿主机。")]),t._v(" "),s("h2",{attrs:{id:"二、约束条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、约束条件"}},[t._v("#")]),t._v(" 二、约束条件")]),t._v(" "),s("h3",{attrs:{id:"检查约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查约束"}},[t._v("#")]),t._v(" 检查约束")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-CHECK-CONSTRAINTS",target:"_blank",rel:"noopener noreferrer"}},[t._v("检查约束"),s("OutboundLink")],1),t._v("是最通用的约束类型。它允许我们指定特定列中的值必须满足布尔表达式。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 要求正值的产品价格")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHECK")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("可以给约束一个独立的名称，这会使错误消息更为清晰，同时也允许我们在需要更改约束时能引用它。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CONSTRAINT")]),t._v(" positive_price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHECK")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("一个检查约束也可以引用多个列。例如我们存储一个普通价格和一个打折后的价格，而我们希望保证打折后的价格低于普通价格。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHECK")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    discounted_price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHECK")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("discounted_price "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHECK")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" discounted_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("一个检查约束在其检查表达式值为 "),s("code",[t._v("true")]),t._v(" 或 "),s("code",[t._v("null")]),t._v(" 值时被满足。")]),t._v(" "),s("h3",{attrs:{id:"非空约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#非空约束"}},[t._v("#")]),t._v(" 非空约束")]),t._v(" "),s("p",[t._v("一个"),s("a",{attrs:{href:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL",target:"_blank",rel:"noopener noreferrer"}},[t._v("非空约束"),s("OutboundLink")],1),t._v("仅仅指定一个列中不会有空值。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"唯一约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#唯一约束"}},[t._v("#")]),t._v(" 唯一约束")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-UNIQUE-CONSTRAINTS",target:"_blank",rel:"noopener noreferrer"}},[t._v("唯一约束"),s("OutboundLink")],1),t._v("保证在一列或一组列中保存的数据在表中所有行间是唯一的。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("为一组列定义一个唯一约束，把它写作一个表级约束，列名用逗号分隔。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product_no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这指定这些列的组合值在整个表的范围内是唯一的，但其中任意一列的值并不需要是唯一的。")]),t._v(" "),s("p",[t._v("为一个唯一约束命名：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CONSTRAINT")]),t._v(" must_be_different "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("增加一个唯一约束会在约束列或列组上自动创建一个唯一 "),s("em",[t._v("B-tree")]),t._v(" 索引。")]),t._v(" "),s("h3",{attrs:{id:"主键约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主键约束"}},[t._v("#")]),t._v(" 主键约束")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-PRIMARY-KEYS",target:"_blank",rel:"noopener noreferrer"}},[t._v("主键约束"),s("OutboundLink")],1),t._v("保证在一列或一组列中可以用作表中行的唯一标识符。这要求值既是唯一的又是非空的。因此，以下两个表定义接受相同的数据。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("主键也可以包含多于一个列，其语法和唯一约束相似。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product_no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("增加一个主键将自动在主键中列出的列或列组上创建一个唯一 "),s("em",[t._v("B-tree")]),t._v(" 索引，并且会强制这些列被标记为 "),s("code",[t._v("NOT NULL")]),t._v("。")]),t._v(" "),s("p",[t._v("一个表最多只能有一个主键。关系数据库理论要求每一个表都要有一个主键，但 PostgreSQL 中并未强制要求这一点，但是最好能够遵循它。")]),t._v(" "),s("h3",{attrs:{id:"外键约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#外键约束"}},[t._v("#")]),t._v(" 外键约束")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",target:"_blank",rel:"noopener noreferrer"}},[t._v("外键约束"),s("OutboundLink")],1),t._v("指定一列或一组列中的值必须匹配出现在另一个表中某些行的值。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    price "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("numeric")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" orders "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    order_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    product_no "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("REFERENCES")]),t._v(" products "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product_no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    quantity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"三、函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、函数"}},[t._v("#")]),t._v(" 三、函数")]),t._v(" "),s("h3",{attrs:{id:"序列"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#序列"}},[t._v("#")]),t._v(" 序列")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/functions-sequence.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("序列"),s("OutboundLink")],1),t._v("是一个数据库对象，本质上是一个自增器。序列在其他同类型数据库软件中以 "),s("code",[t._v("AUTO_INCREMENT")]),t._v(" 值的形式存在。")]),t._v(" "),s("p",[t._v("序列对象是使用 "),s("a",{attrs:{href:"https://www.postgresql.org/docs/12/sql-createsequence.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("CREATE SEQUENCE")]),s("OutboundLink")],1),t._v(" 创建的特殊单行表，序列对象通常用于为表的行生成唯一标识符。")]),t._v(" "),s("p",[t._v("序列对象中包含当前值，和一些独特属性，例如如何递增或递减。序列不能直接访问，需要通过 PostgreSQL 中的相关函数来操作它们。")]),t._v(" "),s("p",[t._v("以下为用于操作序列对象的函数，也称为序列生成器或序列。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("nextval")]),t._v("("),s("em",[t._v("regclass")]),t._v(") → "),s("code",[t._v("bigint")])]),t._v(" "),s("p",[t._v("将序列对象前进到它的下一个值并返回该值。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("setval")]),t._v("("),s("em",[t._v("regclass")]),t._v(", "),s("em",[t._v("bigint")]),t._v(" [, "),s("em",[t._v("boolean")]),t._v(" ]) → "),s("code",[t._v("bigint")])]),t._v(" "),s("p",[t._v("设置序列的当前值。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("currval")]),t._v("("),s("em",[t._v("regclass")]),t._v(") → "),s("code",[t._v("bigint")])]),t._v(" "),s("p",[t._v("返回指定序列最近使用 "),s("code",[t._v("nextval")]),t._v(" 获得的值，即 "),s("em",[t._v("last_value")]),t._v("。")])])]),t._v(" "),s("h4",{attrs:{id:"创建序列"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建序列"}},[t._v("#")]),t._v(" 创建序列")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" SEQUENCE sequence_name\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" INCREMENT increment "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 自增数，默认是 1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" MINVALUE minvalue "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 最小值")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" MAXVALUE maxvalue "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 最大值")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("START")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("start")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 起始值")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" CACHE cache "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 是否预先缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CYCLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 到达最大值时，是否重新返回到最小值")]),t._v("\n")])])]),s("p",[t._v("序列使用的是整型数值。创建一个简单的序列：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" SEQUENCE sequence_name MINVALUE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"查看序列"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看序列"}},[t._v("#")]),t._v(" 查看序列")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/17/app-psql.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("psql")]),s("OutboundLink")],1),t._v(" 的 "),s("a",{attrs:{href:"https://www.postgresql.org/docs/17/app-psql.html#APP-PSQL-META-COMMAND-D",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("\\d")]),s("OutboundLink")],1),t._v(" 命令输出一个数据库对象，包括序列，表，视图和索引，还可以使用 "),s("a",{attrs:{href:"https://www.postgresql.org/docs/17/app-psql.html#APP-PSQL-META-COMMAND-DE",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("\\ds")]),s("OutboundLink")],1),t._v(" 命令只查看当前数据库的所有序列。")]),t._v(" "),s("p",[t._v("序列就像表和视图一样，拥有自己的结构，只不过它的结构是固定的。")]),t._v(" "),s("p",[t._v("查询 "),s("code",[t._v("sequence_name")]),t._v(" 的 "),s("code",[t._v("last_value")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" last_value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" sequence_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"删除序列"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除序列"}},[t._v("#")]),t._v(" 删除序列")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" SEQUENCE sequence_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("如果该序列无法直接删除，可以查询是否被数据库中的其他对象引用。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adsrc "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" pg_class p\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" pg_attrdef a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relfilenode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adrelid\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adsrc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sequence_name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"四、服务器管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、服务器管理"}},[t._v("#")]),t._v(" 四、服务器管理")]),t._v(" "),s("h3",{attrs:{id:"服务器配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置"}},[t._v("#")]),t._v(" 服务器配置")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/config-setting.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("设置参数"),s("OutboundLink")],1),t._v("的最基本方法是编辑 "),s("a",{attrs:{href:"https://www.postgresql.org/docs/12/config-setting.html#CONFIG-SETTING-CONFIGURATION-FILE",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("postgresql.conf")]),s("OutboundLink")],1),t._v(" 文件，该文件通常保存在数据目录中。")]),t._v(" "),s("p",[t._v("通过 SQL 查询配置文件和数据目录位置。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SHOW config_file"')]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件目录")]),t._v("\npsql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SHOW data_directory"')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据目录")]),t._v("\n")])])]),s("p",[t._v("通过 "),s("a",{attrs:{href:"https://www.postgresql.org/docs/17/app-pgconfig.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("pg_config")]),s("OutboundLink")],1),t._v(" 可以查询执行文件所在目录。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("pg_config "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--bindir")]),t._v("\n")])])]),s("h4",{attrs:{id:"连接设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接设置"}},[t._v("#")]),t._v(" 连接设置")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/runtime-config-connection.html#RUNTIME-CONFIG-CONNECTION-SETTINGS",target:"_blank",rel:"noopener noreferrer"}},[t._v("连接设置"),s("OutboundLink")],1),t._v("的相关配置项如下。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("listen_addresses")]),t._v("("),s("em",[t._v("string")]),t._v(")")]),t._v(" "),s("p",[t._v("指定服务器在哪些 TCP/IP 地址上监听客户端连接。该值采用逗号分隔的主机名或数字 IP 地址列表的形式。特殊条目 "),s("code",[t._v("*")]),t._v(" 对应于所有可用的 IP 接口。")])])]),t._v(" "),s("h3",{attrs:{id:"客户端认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端认证"}},[t._v("#")]),t._v(" 客户端认证")]),t._v(" "),s("h4",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),s("p",[t._v("客户端身份验证由一个配置文件控制，该文件通常名为 "),s("a",{attrs:{href:"https://www.postgresql.org/docs/12/auth-pg-hba-conf.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("pg_hba.conf")]),s("OutboundLink")],1),t._v(" 并存储在数据库集簇的数据目录中。")]),t._v(" "),s("p",[s("code",[t._v("pg_hba.conf")]),t._v(" 文件的格式是一组记录，每行一个。空白行将被忽略，"),s("code",[t._v("#")]),t._v(" 注释字符之后的任何文本也是如此。")]),t._v(" "),s("p",[t._v("每条记录指定一种连接类型、一个数据库名称、一个用户名、一个客户端 IP 地址范围以及对匹配这些参数的连接使用的认证方法。")]),t._v(" "),s("p",[t._v("记录可以是下面格式之一：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("host    all             all             127.0.0.1/32            trust\nhost    database        user            address                 auth-method  [auth-options]\n")])])]),s("h4",{attrs:{id:"身份验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#身份验证"}},[t._v("#")]),t._v(" 身份验证")]),t._v(" "),s("p",[t._v("PostgreSQL 提供了多种"),s("a",{attrs:{href:"https://www.postgresql.org/docs/12/auth-methods.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("验证用户"),s("OutboundLink")],1),t._v("的方法：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/auth-trust.html",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Trust authentication")]),s("OutboundLink")],1),t._v("：简单的信任用户声称的身份。")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.postgresql.org/docs/current/auth-password.html",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Password authentication")]),s("OutboundLink")],1),t._v("：需要用户提供密码。")])]),t._v(" "),s("h4",{attrs:{id:"密码认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#密码认证"}},[t._v("#")]),t._v(" 密码认证")]),t._v(" "),s("p",[t._v("有几种基于"),s("a",{attrs:{href:"https://www.postgresql.org/docs/12/auth-password.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("密码"),s("OutboundLink")],1),t._v("的身份验证方法。这些方法的操作类似，但不同之处在于用户密码如何存储在服务器上以及客户端提供的密码如何通过连接发送。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("scram-sha-256")])]),t._v(" "),s("p",[s("code",[t._v("scram-sha-256")]),t._v(" 方法执行 SCRAM-SHA-256 身份验证。它是一种"),s("em",[t._v("质询 - 响应")]),t._v("方案，可防止在不受信任的连接上嗅探密码，并支持以被认为安全的加密散列形式将密码存储在服务器上。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("md5")])]),t._v(" "),s("p",[s("code",[t._v("md5")]),t._v(" 方法使用自定义的安全性较低的"),s("em",[t._v("质询 - 响应")]),t._v("机制。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("password")])]),t._v(" "),s("p",[s("code",[t._v("password")]),t._v(" 方法以明文形式发送密码，因此容易受到密码嗅探攻击。")])])]),t._v(" "),s("h3",{attrs:{id:"账户管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#账户管理"}},[t._v("#")]),t._v(" 账户管理")]),t._v(" "),s("h4",{attrs:{id:"修改密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改密码"}},[t._v("#")]),t._v(" 修改密码")]),t._v(" "),s("p",[t._v("通过 SQL 修改用户密码。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"ALTER USER postgres WITH PASSWORD 'new-password'\"")]),t._v("\n")])])]),s("h2",{attrs:{id:"五、命令行程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、命令行程序"}},[t._v("#")]),t._v(" 五、命令行程序")]),t._v(" "),s("h3",{attrs:{id:"initdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initdb"}},[t._v("#")]),t._v(" initdb")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/app-initdb.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("initdb")]),s("OutboundLink")],1),t._v(" 用于创建一个新的 PostgreSQL 数据库集簇。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("initdb [option...] [ --pgdata | -D ] directory\n")])])]),s("p",[t._v("安装完成后，可以进行初始化操作。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("/usr/pgsql-10/bin/initdb "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pgdata")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/lib/pgsql/10/data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--auth")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("trust "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("postgres "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--pwprompt")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("--"),s("strong",[t._v("auth")]),t._v("="),s("em",[t._v("authmethod")])]),t._v(" "),s("p",[t._v("为本地用户指定在 "),s("code",[t._v("pg_hba.conf")]),t._v(" 中使用的默认认证方法。")])]),t._v(" "),s("li",[s("p",[t._v("--"),s("strong",[t._v("auth-host")]),t._v("="),s("em",[t._v("authmethod")])]),t._v(" "),s("p",[t._v("为通过 TCP/IP 连接的本地用户指定在 "),s("code",[t._v("pg_hba.conf")]),t._v(" 中使用的认证方法。")])]),t._v(" "),s("li",[s("p",[t._v("--"),s("strong",[t._v("auth-local")]),t._v("="),s("em",[t._v("authmethod")])]),t._v(" "),s("p",[t._v("为通过 Unix 域套接字连接的本地用户指定在 "),s("code",[t._v("pg_hba.conf")]),t._v(" 中使用的认证方法。")])]),t._v(" "),s("li",[s("p",[t._v("-"),s("strong",[t._v("D")]),t._v(" "),s("em",[t._v("directory")])])]),t._v(" "),s("li",[s("p",[t._v("--"),s("strong",[t._v("pgdata")]),t._v("="),s("em",[t._v("directory")])]),t._v(" "),s("p",[t._v("指定数据库集簇应该存放的目录。")])]),t._v(" "),s("li",[s("p",[t._v("--"),s("strong",[t._v("encoding")]),t._v("="),s("em",[t._v("encoding")])]),t._v(" "),s("p",[t._v("选择模板数据库的编码。这也将是后来创建的任何数据库的默认编码。")])]),t._v(" "),s("li",[s("p",[t._v("--"),s("strong",[t._v("username")]),t._v("="),s("em",[t._v("username")])]),t._v(" "),s("p",[t._v("选择数据库超级用户的用户名。")])]),t._v(" "),s("li",[s("p",[t._v("--"),s("strong",[t._v("pwprompt")])]),t._v(" "),s("p",[t._v("让 "),s("code",[t._v("initdb")]),t._v(" 提示要求为数据库超级用户给予一个口令。")])])]),t._v(" "),s("h3",{attrs:{id:"createuser"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#createuser"}},[t._v("#")]),t._v(" createuser")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/app-createuser.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("createuser")]),s("OutboundLink")],1),t._v(" 用于定义一个新的 PostgreSQL 用户帐户。")]),t._v(" "),s("ul",[s("li",[t._v("-"),s("strong",[t._v("P")]),t._v(", --"),s("strong",[t._v("pwprompt")]),t._v("：如果给定，"),s("code",[t._v("createuser")]),t._v(" 将提示输入新用户的密码。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("s")]),t._v(", --"),s("strong",[t._v("superuser")]),t._v("：新用户将是超级用户。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("e")]),t._v(", --"),s("strong",[t._v("echo")]),t._v("：回显 "),s("code",[t._v("createuser")]),t._v(" 生成并发送到服务器的命令。")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" postgres\ncreateuser "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-P")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" sonar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"psql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#psql"}},[t._v("#")]),t._v(" psql")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/app-psql.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("psql")]),s("OutboundLink")],1),t._v(" 是 PostgreSQL 的一个基于终端的前端。")]),t._v(" "),s("ul",[s("li",[t._v("-"),s("strong",[t._v("U")]),t._v(" "),s("em",[t._v("username")]),t._v(", --"),s("strong",[t._v("username")]),t._v("="),s("em",[t._v("username")]),t._v("：以指定用户名连接到数据库。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("d")]),t._v(" "),s("em",[t._v("dbname")]),t._v(", --"),s("strong",[t._v("dbname")]),t._v("="),s("em",[t._v("dbname")]),t._v("：指定要连接到的数据库的名称。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("h")]),t._v(" "),s("em",[t._v("hostname")]),t._v(", --"),s("strong",[t._v("host")]),t._v("="),s("em",[t._v("hostname")]),t._v("：指定运行服务器的计算机的主机名。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("p")]),t._v(" "),s("em",[t._v("port")]),t._v(", --"),s("strong",[t._v("port")]),t._v("="),s("em",[t._v("port")]),t._v("：指定服务器正在侦听连接的 TCP 端口。")])]),t._v(" "),s("p",[t._v("连接指定数据库。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" dbuser "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" exampledb "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v("\n")])])]),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/app-psql.html#APP-PSQL-META-COMMANDS",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Meta 命令")]),s("OutboundLink")],1),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("\\"),s("strong",[t._v("l")]),t._v("：列出服务器中的数据库，并显示它们的名称、所有者、字符集编码和访问权限。")]),t._v(" "),s("li",[t._v("\\"),s("strong",[t._v("c")]),t._v(" "),s("em",[t._v("dbname")]),t._v("：建立到 PostgreSQL 服务器的新连接。")]),t._v(" "),s("li",[t._v("\\"),s("strong",[t._v("dt")]),t._v("：列举表，"),s("code",[t._v("t")]),t._v(" 为表。")]),t._v(" "),s("li",[t._v("\\"),s("strong",[t._v("z")]),t._v("：列出表、视图和序列及其关联的访问权限。")]),t._v(" "),s("li",[t._v("\\"),s("strong",[t._v("encoding")]),t._v("：设置客户端字符集编码。如果没有参数，此命令将显示当前编码。")]),t._v(" "),s("li",[t._v("\\"),s("strong",[t._v("q")]),t._v("：退出 "),s("code",[t._v("psql")]),t._v(" 程序。")])]),t._v(" "),s("h3",{attrs:{id:"pg-dump"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pg-dump"}},[t._v("#")]),t._v(" pg_dump")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/12/app-pgdump.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("pg_dump")]),s("OutboundLink")],1),t._v(" 是一个用于备份 PostgreSQL 数据库的实用程序。")]),t._v(" "),s("ul",[s("li",[t._v("-"),s("strong",[t._v("U")]),t._v(" "),s("em",[t._v("username")]),t._v("：连接的用户名。")]),t._v(" "),s("li",[t._v("-"),s("strong",[t._v("d")]),t._v(" "),s("em",[t._v("dbname")]),t._v("：指定要连接到的数据库的名称。")])]),t._v(" "),s("p",[t._v("备份单个数据库。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("pg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mydb.pgsql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 压缩")]),t._v("\npg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mydb.pgsql.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分包")]),t._v("\npg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" 100M - mydb.pgsql.gz\n")])])]),s("p",[t._v("备份单个表。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("pg_dump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" mytable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mydb-mytable.pgsql\n")])])]),s("p",[t._v("恢复数据。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" mydb.pgsql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压")]),t._v("\ngunzip "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" mydb.pgsql.gz "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 合包")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" mydb.pgsql.gz* "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" gunzip "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" postgres "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" mydb\n")])])]),s("h3",{attrs:{id:"pg-controldata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pg-controldata"}},[t._v("#")]),t._v(" pg_controldata")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.postgresql.org/docs/15/app-pgcontroldata.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("pg_controldata")]),s("OutboundLink")],1),t._v(" 用于显示 PostgreSQL 数据库集群的控制信息。")]),t._v(" "),s("p",[t._v("控制文件 "),s("code",[t._v("global/pg_control")]),t._v(" 包含了关于数据库集群的信息，包括版本号。")]),t._v(" "),s("p",[t._v("可以使用 "),s("code",[t._v("pg_controldata")]),t._v(" 工具来读取这个文件的信息。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("/usr/pgsql-12/bin/pg_controldata /path/to/data/directory\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);