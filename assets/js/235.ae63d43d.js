(window.webpackJsonp=window.webpackJsonp||[]).push([[235],{548:function(a,s,t){"use strict";t.r(s);var e=t(27),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"restic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#restic"}},[a._v("#")]),a._v(" restic")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/restic/restic",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("restic")]),s("OutboundLink")],1),a._v(" 是一个快速、高效、安全的备份程序。")]),a._v(" "),s("h2",{attrs:{id:"一、安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、安装"}},[a._v("#")]),a._v(" 一、安装")]),a._v(" "),s("h3",{attrs:{id:"debian"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#debian"}},[a._v("#")]),a._v(" Debian")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" restic\n")])])]),s("h2",{attrs:{id:"二、配置存储库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、配置存储库"}},[a._v("#")]),a._v(" 二、配置存储库")]),a._v(" "),s("h3",{attrs:{id:"amazon-s3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#amazon-s3"}},[a._v("#")]),a._v(" Amazon S3")]),a._v(" "),s("p",[a._v("配置 "),s("a",{attrs:{href:"https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html#amazon-s3",target:"_blank",rel:"noopener noreferrer"}},[a._v("AWS"),s("OutboundLink")],1),a._v(" 密钥。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_ACCESS_KEY_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("MY_ACCESS_KEY"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_SECRET_ACCESS_KEY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("MY_SECRET_ACCESS_KEY"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("配置"),s("a",{attrs:{href:"https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html#s3-compatible-storage",target:"_blank",rel:"noopener noreferrer"}},[a._v("存储区域"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_DEFAULT_REGION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("us-north-1\n")])])]),s("p",[a._v("初始化 AWS 作为后端的存储库。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" s3:s3.amazonaws.com/bucket_name init\n")])])]),s("p",[a._v("初始化"),s("a",{attrs:{href:"https://developer.qiniu.com/kodo/12503/restic-s3-kodo",target:"_blank",rel:"noopener noreferrer"}},[a._v("七牛云 S3"),s("OutboundLink")],1),a._v(" 作为后端的存储库。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" s3:https://s3.us-north-1.qiniucs.com/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("bucket_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" init\n")])])]),s("h2",{attrs:{id:"三、备份数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、备份数据"}},[a._v("#")]),a._v(" 三、备份数据")]),a._v(" "),s("h3",{attrs:{id:"备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[a._v("#")]),a._v(" 备份")]),a._v(" "),s("p",[a._v("备份 "),s("code",[a._v("/home/data")]),a._v(" 到存储库 "),s("code",[a._v("/data/backup")]),a._v(" 中。"),s("code",[a._v("/home/data")]),a._v(" 可以为目录或者单文件。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup backup /home/data\n")])])]),s("p",[a._v("上传的时候进行限速，以及读取密码文件。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --limit-upload"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30000")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --password-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/passwd/restic_bj1_passwd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    backup /data/app/data_cache\n")])])]),s("p",[a._v("从标准输出来保存数据。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("mysqldump "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /srv/restic-repo backup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--stdin")]),a._v(" --stdin-filename production.sql\n")])])]),s("h3",{attrs:{id:"快照"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快照"}},[a._v("#")]),a._v(" 快照")]),a._v(" "),s("p",[a._v("列出存储库中的可用快照。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup snapshots\n")])])]),s("p",[a._v("检查两个快照之间的差异。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("diff")]),a._v(" 6eda7c7d b52d462b\n")])])]),s("h3",{attrs:{id:"恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复"}},[a._v("#")]),a._v(" 恢复")]),a._v(" "),s("p",[a._v("将数据从快照 "),s("em",[a._v("b52d462b")]),a._v(" 恢复到 "),s("code",[a._v("/home/data")]),a._v(" 目录。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup restore b52d462b "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--target")]),a._v(" /home/data\n")])])]),s("p",[a._v("将备份作为常规文件系统进行浏览。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" path/to/mount\n")])])]),s("h3",{attrs:{id:"删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[a._v("#")]),a._v(" 删除")]),a._v(" "),s("p",[a._v("删除快照列表信息。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup snapshots         "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 列出存储库中的可用快照")]),a._v("\nrestic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup forget 6eda7c7d   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 根据ID删除指定快照")]),a._v("\n")])])]),s("p",[a._v("从存储库中删除不需要的数据。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup prune\n")])])]),s("p",[a._v("只保留最近一定数量的快照。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("restic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /data/backup forget --keep-last "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--prune")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);