(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{512:function(t,s,a){"use strict";a.r(s);var e=a(27),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"sqlalchemy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sqlalchemy"}},[t._v("#")]),t._v(" SQLAlchemy")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/sqlalchemy/sqlalchemy",target:"_blank",rel:"noopener noreferrer"}},[t._v("SQLAlchemy"),s("OutboundLink")],1),t._v(" 是 Python 的 SQL 工具包与对象关系映射（ORM）框架。")]),t._v(" "),s("p",[s("strong",[t._v("安装")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("pip "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" SQLAlchemy\n")])])]),s("h2",{attrs:{id:"一、引擎和连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、引擎和连接"}},[t._v("#")]),t._v(" 一、引擎和连接")]),t._v(" "),s("h3",{attrs:{id:"数据库-url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库-url"}},[t._v("#")]),t._v(" 数据库 URL")]),t._v(" "),s("p",[s("code",[t._v("create_engine()")]),t._v(" 函数通过"),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据库 URL"),s("OutboundLink")],1),t._v(" 生成 SQLAlchemy 的 "),s("code",[t._v("Engine")]),t._v(" 对象。其 URL 格式基于 "),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc1738",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC-1738"),s("OutboundLink")],1),t._v(" 标准，通常包括用户名、密码、主机名、数据库名称字段，以及用于其他配置的可选关键字参数。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("dialect+driver://username:password@host:port/database\n")])])]),s("ul",[s("li",[s("code",[t._v("dialect")]),t._v("：SQLAlchemy 方言的标识名称，例如 "),s("code",[t._v("sqlite")]),t._v("、"),s("code",[t._v("mysql")]),t._v("、"),s("code",[t._v("postgresql")]),t._v("、"),s("code",[t._v("oracle")]),t._v(" 或 "),s("code",[t._v("mssql")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("driver")]),t._v("：用于连接到数据库的 DBAPI 的名称，全部使用小写字母。")])]),t._v(" "),s("p",[s("strong",[t._v("密码转义")]),t._v("：")]),t._v(" "),s("p",[t._v("在构建完整格式的 URL 字符串以传递给 "),s("code",[t._v("create_engine()")]),t._v(" 时，需要对可能在用户和密码中使用的特殊字符进行 URL 编码才能正确解析。")]),t._v(" "),s("h3",{attrs:{id:"引擎创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引擎创建"}},[t._v("#")]),t._v(" 引擎创建")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("create_engine")]),t._v("("),s("em",[t._v("url")]),t._v(", **"),s("em",[t._v("kwargs")]),t._v(")")]),t._v(" "),s("p",[t._v("创建一个新的 "),s("code",[t._v("Engine")]),t._v(" 实例。")]),t._v(" "),s("p",[t._v("标准调用形式是将 URL 作为第一个位置参数发送，通常是指数据库方言和连接参数的字符串。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" create_engine\n\nengine "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgresql://scott:tiger@localhost/test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"二、session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、session"}},[t._v("#")]),t._v(" 二、Session")]),t._v(" "),s("h3",{attrs:{id:"会话周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会话周期"}},[t._v("#")]),t._v(" 会话周期")]),t._v(" "),s("p",[t._v("SQLAlchemy 的 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/session_basics.html#opening-and-closing-a-session",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Session")]),s("OutboundLink")],1),t._v(" 会话对象可通过直接实例化或 "),s("code",[t._v("sessionmaker")]),t._v(" 工厂类创建，需绑定至单一 "),s("code",[t._v("Engine")]),t._v(" 实例作为数据库连接核心。推荐通过 "),s("code",[t._v("sessionmaker")]),t._v(" 预定义会话配置（如自动提交策略、事务隔离级别），确保会话行为一致性。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" create_engine\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sessionmaker\n\nengine "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sqlite:///mydb.sqlite"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nSession "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sessionmaker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bind"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成预配置的会话类")]),t._v("\nsession "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例化具体会话对象")]),t._v("\n")])])]),s("h3",{attrs:{id:"查询数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询数据"}},[t._v("#")]),t._v(" 查询数据")]),t._v(" "),s("p",[t._v("SQLAlchemy 2.0 将通过 ORM 直接采用统一的 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/selectable.html#sqlalchemy.sql.expression.Select",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Select")]),s("OutboundLink")],1),t._v(" 对象替代传统 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/query.html#sqlalchemy.orm.Query",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Query")]),s("OutboundLink")],1),t._v(" 对象，实现 Core 与 ORM 层 "),s("code",[t._v("SELECT")]),t._v(" 语句生成方式的标准化。")]),t._v(" "),s("blockquote",[s("p",[t._v("此兼容模式已在当前 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/session_basics.html#querying-2-0-style",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.4"),s("OutboundLink")],1),t._v(" 版本中提供，便于向 2.0 版本过渡迁移。")])]),t._v(" "),s("p",[t._v("标准查询流程为通过 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/selectable.html#sqlalchemy.sql.expression.select",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("select()")]),s("OutboundLink")],1),t._v(" 构造 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/selectable.html#sqlalchemy.sql.expression.Select",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Select")]),s("OutboundLink")],1),t._v(" 对象，并借助 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/session_api.html#sqlalchemy.orm.Session.execute",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Session.execute()")]),s("OutboundLink")],1),t._v(" 或 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/session_api.html#sqlalchemy.orm.Session.scalars",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Session.scalars()")]),s("OutboundLink")],1),t._v(" 等方法执行，分别返回 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Result",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Result")]),s("OutboundLink")],1),t._v(" 及其子类型（如 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.ScalarResult",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("ScalarResult")]),s("OutboundLink")],1),t._v("），进而获取查询结果集。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" select\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Session\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" Session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询 User 对象")]),t._v("\n    statement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" select"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter_by"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ed"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# User 对象列表")]),t._v("\n    user_obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scalars"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("statement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询单个列")]),t._v("\n    statement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" select"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fullname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 行对象列表")]),t._v("\n    rows "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("statement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("也可以通过 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/session_api.html#sqlalchemy.orm.Session.query",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Session.query()")]),s("OutboundLink")],1),t._v(" 构建 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/query.html#sqlalchemy.orm.Query",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Query")]),s("OutboundLink")],1),t._v(" 对象。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("one"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"新增数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新增数据"}},[t._v("#")]),t._v(" 新增数据")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/session_api.html#sqlalchemy.orm.Session.add",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Session.add()")]),s("OutboundLink")],1),t._v(" 用于将实例纳入会话管理：")]),t._v(" "),s("ul",[s("li",[t._v("瞬态实例（新创建对象）：将在下次刷新时触发 "),s("code",[t._v("INSERT")]),t._v(" 操作。")]),t._v(" "),s("li",[t._v("持久态实例（已被当前会话加载）：已存在于会话中无需重复添加。")]),t._v(" "),s("li",[t._v("游离态实例（已脱离原会话）：可通过此方法重新与会话建立关联。")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("user1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nuser2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"三、orm-映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、orm-映射"}},[t._v("#")]),t._v(" 三、ORM 映射")]),t._v(" "),s("h3",{attrs:{id:"声明式映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#声明式映射"}},[t._v("#")]),t._v(" 声明式映射")]),t._v(" "),s("p",[t._v("SQLAlchemy 的"),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/declarative_styles.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("声明式映射"),s("OutboundLink")],1),t._v("作为 ORM 框架核心机制，通过 "),s("code",[t._v("declarative_base()")]),t._v(" 创建基类实现模型统一管理，该基类将自动继承声明式元数据配置至所有派生模型类，形成标准化的对象关系映射体系。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ForeignKey\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" declarative_base\n\nBase "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" declarative_base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    __tablename__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" primary_key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fullname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nickname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("基类本质是承载 ORM 元数据管理的 "),s("code",[t._v("registry")]),t._v(" 对象。"),s("code",[t._v("declarative_base()")]),t._v(" 函数作为快捷实现方式，其底层机制是通过 "),s("code",[t._v("registry")]),t._v(" 构造函数初始化注册表实例，随后调用 "),s("code",[t._v("registry.generate_base()")]),t._v(" 方法动态生成声明式基类，从而简化 ORM 模型类的标准化构建流程。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" registry\n\nmapper_registry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nBase "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mapper_registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("generate_base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("版本 2.0 更新："),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/declarative_styles.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("声明式映射"),s("OutboundLink")],1),t._v("体系重构为采用 "),s("code",[t._v("DeclarativeBase")]),t._v(" 超类，取代原有 "),s("code",[t._v("declarative_base()")]),t._v(" 函数及 "),s("code",[t._v("registry.generate_base()")]),t._v(" 方法，该超类设计原生支持 PEP 484 类型注解，无需依赖插件即可实现类型工具集成。")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ForeignKey\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" DeclarativeBase\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Mapped\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" mapped_column\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Base")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DeclarativeBase"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    __tablename__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mapped"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mapped_column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("primary_key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mapped"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    fullname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mapped"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mapped_column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nickname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mapped"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Optional"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"映射表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#映射表"}},[t._v("#")]),t._v(" 映射表")]),t._v(" "),s("p",[t._v("在"),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/declarative_tables.html#declarative-table",target:"_blank",rel:"noopener noreferrer"}},[t._v("声明式基类"),s("OutboundLink")],1),t._v("映射中，标准做法需定义 "),s("code",[t._v("__tablename__")]),t._v(" 属性以指定对应的数据表名称，该属性将触发 ORM 框架同步生成与模型类映射的 "),s("code",[t._v("Table")]),t._v(" 对象。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ForeignKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("orm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" declarative_base\n\nBase "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" declarative_base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    __tablename__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" primary_key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fullname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nickname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"表和元数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表和元数据"}},[t._v("#")]),t._v(" 表和元数据")]),t._v(" "),s("p",[t._v("在声明式映射类中，"),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/orm/declarative_tables.html#accessing-table-and-metadata",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("__table__")]),s("OutboundLink")],1),t._v(" 属性作为 ORM 元数据核心载体，当开发者定义 "),s("code",[t._v("__tablename__")]),t._v(" 声明表名后，ORM 框架将自动生成对应的 "),s("code",[t._v("Table")]),t._v(" 对象并持久化存储于该属性，为后续数据库操作提供结构化元数据支撑。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问表")]),t._v("\nuser_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__table__\n")])])]),s("p",[t._v("声明式注册表与基类所关联的元数据（"),s("code",[t._v("MetaData")]),t._v("）是执行 DDL 操作及集成迁移工具不可或缺的核心组件。开发者可通过注册表的 "),s("code",[t._v(".metadata")]),t._v(" 属性或声明式基类直接访问该元数据对象。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("engine "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sqlite://"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nBase"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"映射表字段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#映射表字段"}},[t._v("#")]),t._v(" 映射表字段")]),t._v(" "),s("p",[t._v("默认情况下，ORM 映射将模型属性名与 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Column")]),s("OutboundLink")],1),t._v(" 对象的键名（"),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column.key",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Column.key")]),s("OutboundLink")],1),t._v("）进行绑定，且 "),s("code",[t._v("Column.key")]),t._v(" 默认与其对应的数据库列名（"),s("code",[t._v("Column.name")]),t._v("）保持一致。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    __tablename__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" primary_key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"驼峰数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#驼峰数据类型"}},[t._v("#")]),t._v(" 驼峰数据类型")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/type_basics.html#the-camelcase-datatypes",target:"_blank",rel:"noopener noreferrer"}},[t._v("驼峰命名"),s("OutboundLink")],1),t._v("规范通过 ORM 框架实现数据库无关性设计，其类型转换机制可跨所有数据库后端动态适配，自动根据目标数据库特性生成符合规范的 DDL 语句。")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/type_basics.html#sqlalchemy.types.Integer",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("Integer")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/type_basics.html#sqlalchemy.types.String",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("String")]),s("OutboundLink")],1),t._v("()")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/type_basics.html#sqlalchemy.types.DateTime",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("DateTime")]),s("OutboundLink")],1),t._v("()")])]),t._v(" "),s("h2",{attrs:{id:"四、查询数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、查询数据"}},[t._v("#")]),t._v(" 四、查询数据")]),t._v(" "),s("h3",{attrs:{id:"select-语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#select-语句"}},[t._v("#")]),t._v(" SELECT 语句")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/select.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SELECT"),s("OutboundLink")],1),t._v(" 语句通过 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/selectable.html#sqlalchemy.sql.expression.select",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("select()")]),s("OutboundLink")],1),t._v(" 函数构建，该函数返回承载查询逻辑的 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/selectable.html#sqlalchemy.sql.expression.Select",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Select")]),s("OutboundLink")],1),t._v(" 对象作为核心执行载体。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" select\n\nstmt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" select"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("where"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spongebob"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"query-对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#query-对象"}},[t._v("#")]),t._v(" Query 对象")]),t._v(" "),s("p",[t._v("在 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SQLAlchemy ORM"),s("OutboundLink")],1),t._v(" 中，可通过调用 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session.query",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Session.query()")]),s("OutboundLink")],1),t._v(" 方法基于指定会话实例化生成 "),s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Query")]),s("OutboundLink")],1),t._v(" 对象，该对象承载 ORM 实体查询的构造与执行逻辑。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SomeMappedClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.all",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("all")]),s("OutboundLink")],1),t._v("：以列表形式返回此查询表示的结果。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.exists",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("exists")]),s("OutboundLink")],1),t._v("：将查询转换为 "),s("code",[t._v("EXISTS (SELECT 1 FROM … WHERE …)")]),t._v(" 形式的 "),s("code",[t._v("EXISTS")]),t._v(" 子查询的便捷方法。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("exists "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter_by"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("等同于：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" username "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.scalar",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("scalar")]),s("OutboundLink")],1),t._v("：返回第一个结果的第一个元素，如果没有行则返回 "),s("code",[t._v("None")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.count",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("count")]),s("OutboundLink")],1),t._v("：返回此查询形成的 SQL 将返回的行数。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.filter",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("filter")]),s("OutboundLink")],1),t._v("：使用 SQL 表达式将给定的过滤条件应用于此查询的副本。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'some name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.filter_by",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("filter_by")]),s("OutboundLink")],1),t._v("：使用关键字表达式将给定的过滤条件应用于此查询的副本。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter_by"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'some name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.one",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("one")]),s("OutboundLink")],1),t._v("：只返回一个结果或引发异常。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.get",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("get")]),s("OutboundLink")],1),t._v("：根据给定的主键标识符返回一个实例，如果找不到则返回 "),s("code",[t._v("None")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.first",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("first")]),s("OutboundLink")],1),t._v("：返回此查询的第一个结果，如果结果不包含任何行，则返回 "),s("code",[t._v("None")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.offset",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("offset")]),s("OutboundLink")],1),t._v("：将 "),s("code",[t._v("OFFSET")]),t._v(" 应用于查询并返回新生成的查询。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.limit",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("limit")]),s("OutboundLink")],1),t._v("：将 "),s("code",[t._v("LIMIT")]),t._v(" 应用于查询并返回新生成的查询。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/orm/queryguide/query.html#sqlalchemy.orm.Query.order_by",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("order_by")]),s("OutboundLink")],1),t._v("：将一个或多个 "),s("code",[t._v("ORDER BY")]),t._v(" 条件应用于查询并返回新生成的查询。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Entity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("order_by"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Entity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Entity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"sql-表达式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql-表达式"}},[t._v("#")]),t._v(" SQL 表达式")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/expression_api.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("sqlalchemy.sql.expression")]),s("OutboundLink")],1),t._v(" 提供了一些辅助函数。")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://docs.sqlalchemy.org/en/20/core/sqlelement.html#sqlalchemy.sql.expression.text",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("text")]),s("OutboundLink")],1),t._v("()")]),t._v(" "),s("p",[t._v("直接表示文本 SQL 字符串。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" text\n\nt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT * FROM users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresult "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);